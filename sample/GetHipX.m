%%
function rec = GetHipX(t,Tc,Td,Ds,Xsd,Xed,k)
    rec = 0.0;
    A = k * Tc - t;
    B = Tc - Td;
    C = Ds - Xsd;
    D = Ds + Xed;
    E = Ds - Xed - Xsd;

    if t < k * Tc + Td
        rec = k * Ds + E / (B * Td * Td) *...
            ( (Td + A) * (Td + A) * (Td + A) - (-A) * (-A) * (-A) ...
              - Td * Td * (Td + A) + Td * Td * (-A) )...
            + Xed / Td * (Td + A)...
            + C / Td * (-A);
    else
        rec = k * Ds + E / (B * B * Td) *...
            ( (-A - Td) * (-A - Td) * (-A - Td) - (Tc + A) * (Tc + A) * (Tc + A) ...
              + B * B * (Tc + A) - B * B * (-A - Td)) ...
            + C / B * (Tc + A) ...
            + D / B * (-A - Td);
    end
end